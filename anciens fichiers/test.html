<!doctype html>
 <html lang="fr">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <head>
 <style type="text/css">

 body{
  font-family:Verdana, Geneva, sans-serif;
  background-color:#b2bdc6;
 } 
 
 table {
  border:3px solid #6495ed;
  border-collapse:collapse;
  width:50%;
  margin:auto;
 }

 tbody {
  background-color:#FFFFFF;
  border:1px solid #6495ed;
 }

 th {

  padding:5px;
  background-color:#EFF6FF;
  width:25%;
 }
 td{
  font-family:sans-serif;
  font-size:80%;
  border:1px solid #6495ed;
  padding:5px;
  text-align:center;
 }

 </style>
 <script>
function rest(){

 var departement=document.getElementById('departement').value
 
 var adresse='https://geo.api.gouv.fr/departements/'+departement+'/communes'
 

 httpRequest = new XMLHttpRequest();

    httpRequest.onreadystatechange = gestion_requete;
    httpRequest.open('GET', adresse);
    httpRequest.send();

}


  function gestion_requete() {
  
    if (httpRequest.readyState === XMLHttpRequest.DONE) {
 
      if (httpRequest.status === 200) {
   
   var donne=httpRequest.responseText;
   donne=JSON.parse(donne)
   
   donne.sort(function(key1,key2){return key1.population < key2.population;} )
   
   document.getElementById("rendu").innerHTML=''
   
   var popu_globale=0
   
   for ( var i = 0 ; i < donne.length ; i++) {
   
    if (donne[i].population > 3000) {
    
    var nouvelleLigne = document.getElementById("rendu").insertRow(-1);
    
    var nouvelleCellule = nouvelleLigne.insertCell(-1);
    
    nouvelleCellule.textContent=donne[i].nom
    
    nouvelleCellule = nouvelleLigne.insertCell(-1);
    
    nouvelleCellule.textContent=i+1
    
    nouvelleCellule = nouvelleLigne.insertCell(-1);
    
    nouvelleCellule.textContent=donne[i].codesPostaux
    
    nouvelleCellule = nouvelleLigne.insertCell(-1);
    
    nouvelleCellule.textContent=donne[i].population
    }

    popu_globale+=donne[i].population

   }
   
   document.getElementById("popu_globale").value=popu_globale

       }
   
   else {
        alert('problème de requête.');
      }
    }
  }

</script>
</head>
<body>
 
 <button onclick="rest()">api rest</button>
 <input type ="text" id="departement" placeholder="numero departement"/>
 <br>
 <input type ="text"  id='popu_globale'/>
 
 <table>
    <thead>
        <tr>
            <th>ville</th>
   <th>classement</th>
   <th>code postaux</th>
   <th>population</th>
        </tr>
    </thead>
    <tbody id="rendu">
        
    </tbody>
</table>

</body>
</html>